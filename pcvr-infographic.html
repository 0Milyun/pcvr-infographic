<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Apex of Immersion: An AI-Powered Visual Guide to the 2025 PCVR Market</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #001219;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
        .flowchart-node {
            border: 2px solid #0a9396;
            background-color: #ffffff;
            color: #001219;
            padding: 1rem;
            border-radius: 0.5rem;
            text-align: center;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            transition: all 0.3s ease-in-out;
        }
        .flowchart-node:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
        .flowchart-vertical-line::before {
            content: '';
            position: absolute;
            left: 50%;
            top: -2rem;
            height: 2rem;
            width: 2px;
            background-color: #94d2bd;
            transform: translateX(-50%);
        }
        .stat-card {
            background-color: white;
            padding: 1.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s, box-shadow 0.3s;
            display: flex;
            flex-direction: column;
        }
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        .brilliant-blues-bg { background-color: #001219; }
        .brilliant-blues-text-main { color: #005f73; }
        .brilliant-blues-text-secondary { color: #0a9396; }
        .brilliant-blues-text-accent { color: #94d2bd; }
        .brilliant-blues-text-highlight { color: #e9d8a6; }
        .brilliant-blues-text-emphasis { color: #ee9b00; }
        
        .ai-button {
            background-color: #ee9b00;
            color: #001219;
            font-weight: bold;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            transition: background-color 0.3s;
            border: 2px solid transparent;
        }
        .ai-button:hover {
            background-color: #e9d8a6;
            border-color: #ee9b00;
        }
        .ai-button:disabled {
            background-color: #9b9b9b;
            cursor: not-allowed;
        }
        #ai-recommendation-result p { margin-bottom: 1rem; }
        .loader {
            width: 48px;
            height: 48px;
            border: 5px solid #e9d8a6;
            border-bottom-color: #005f73;
            border-radius: 50%;
            display: inline-block;
            box-sizing: border-box;
            animation: rotation 1s linear infinite;
        }
        @keyframes rotation {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        #aiSummaryModal { transition: opacity 0.3s ease; }
    </style>
</head>
<body class="brilliant-blues-bg text-gray-800">

    <header class="text-white text-center py-12 px-4">
        <h1 class="text-4xl md:text-6xl font-black brilliant-blues-text-highlight uppercase tracking-wider">The Apex of Immersion</h1>
        <p class="mt-4 text-lg md:text-xl max-w-3xl mx-auto brilliant-blues-text-accent">An AI-Powered Visual Guide to the 2025 PCVR Market</p>
    </header>

    <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
        <section id="intro" class="mb-16">
            <div class="stat-card text-center">
                <h2 class="text-3xl md:text-5xl font-bold brilliant-blues-text-main">There Is No Single "Best" PCVR Headset.</h2>
                <p class="mt-4 text-lg md:text-xl max-w-4xl mx-auto text-gray-600">The PCVR landscape is a vibrant arena defined by specialization. The "highest rated" headset depends on your priorities. This guide uses data and AI to help you find your perfect fit.</p>
            </div>
        </section>

        <section id="ai-recommender" class="mb-16">
            <div class="stat-card">
                <h2 class="text-3xl font-bold text-center mb-4 brilliant-blues-text-highlight">‚ú® AI-Powered Personal Shopper</h2>
                <p class="text-center text-gray-600 max-w-2xl mx-auto mb-6">Describe what you're looking for in a PCVR headset. Mention your budget, the types of games you play (e.g., flight sims, fast-paced shooters, social VR), and what's most important to you (e.g., comfort, visual quality, wireless freedom).</p>
                <textarea id="user-prompt" class="w-full p-3 border-2 border-gray-300 rounded-lg mb-4 focus:ring-2 focus:ring-blue-500 focus:border-blue-500" rows="4" placeholder="e.g., I have a budget of around $1000 and mostly play racing simulators. I want the absolute best visual clarity possible and don't mind a wired connection..."></textarea>
                <button id="get-recommendation-btn" class="ai-button w-full md:w-1/2 mx-auto">Get AI Recommendation</button>
                <div id="ai-recommendation-result" class="mt-6 text-gray-700 p-4 bg-gray-50 rounded-lg min-h-[100px]">
                    Your personalized recommendation will appear here...
                </div>
            </div>
        </section>

        <section id="metrics" class="mb-16">
            <h2 class="text-3xl font-bold text-center mb-8 brilliant-blues-text-highlight">The Core Metrics of Excellence</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <div class="stat-card flex-grow"><h3 class="text-xl font-bold brilliant-blues-text-main flex items-center"><span class="text-3xl mr-3">üëÅÔ∏è</span>Visual Fidelity</h3><p class="mt-2 text-gray-600">Beyond resolution, this includes lens quality (Pancake vs. Fresnel), display technology (OLED vs. LCD), and clarity (PPD).</p></div>
                <div class="stat-card flex-grow"><h3 class="text-xl font-bold brilliant-blues-text-main flex items-center"><span class="text-3xl mr-3">üéß</span>Immersion</h3><p class="mt-2 text-gray-600">Driven by Field of View (FOV) for peripheral vision and high-quality integrated audio for spatial awareness.</p></div>
                <div class="stat-card flex-grow"><h3 class="text-xl font-bold brilliant-blues-text-main flex items-center"><span class="text-3xl mr-3">üéØ</span>Tracking & Performance</h3><p class="mt-2 text-gray-600">The precision of tracking systems (Inside-Out vs. Lighthouse) and high refresh rates (Hz) for smooth, responsive gameplay.</p></div>
                <div class="stat-card flex-grow"><h3 class="text-xl font-bold brilliant-blues-text-main flex items-center"><span class="text-3xl mr-3">‚öñÔ∏è</span>Comfort & Ergonomics</h3><p class="mt-2 text-gray-600">Crucial for long sessions, this involves headset weight, balance, and the design of the head strap and face cushion.</p></div>
                <div class="stat-card flex-grow"><h3 class="text-xl font-bold brilliant-blues-text-main flex items-center"><span class="text-3xl mr-3">üîå</span>Connectivity & Ecosystem</h3><p class="mt-2 text-gray-600">The choice between untethered wireless freedom and the pure fidelity of a wired connection, plus software stability.</p></div>
                <div class="stat-card flex-grow"><h3 class="text-xl font-bold brilliant-blues-text-main flex items-center"><span class="text-3xl mr-3">üí∞</span>Value for Money</h3><p class="mt-2 text-gray-600">Considers the total cost of ownership, including the headset, required accessories (like base stations), and potential PC upgrades.</p></div>
            </div>
        </section>
        
        <section id="contenders" class="mb-16">
            <h2 class="text-3xl font-bold text-center mb-8 brilliant-blues-text-highlight">The Contenders: Head-to-Head Comparison</h2>
             <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <div class="stat-card">
                    <div class="flex-grow">
                        <h3 class="text-2xl font-bold brilliant-blues-text-secondary">Meta Quest 3</h3>
                        <p class="font-semibold brilliant-blues-text-emphasis">The Versatile All-Rounder</p>
                        <p class="mt-2 text-sm text-gray-600">The benchmark for value, combining strong standalone features with excellent wireless PCVR and clear pancake lenses, making it the top choice for a broad audience.</p>
                        <div class="mt-4 chart-container h-64 sm:h-72"><canvas id="quest3Radar"></canvas></div>
                    </div>
                    <button class="ai-button mt-4" onclick="getAiSummary('Meta Quest 3')">‚ú® AI Summary</button>
                </div>
                <div class="stat-card">
                    <div class="flex-grow">
                        <h3 class="text-2xl font-bold brilliant-blues-text-secondary">Valve Index</h3>
                        <p class="font-semibold brilliant-blues-text-emphasis">The Tracking & Audio Champion</p>
                        <p class="mt-2 text-sm text-gray-600">Though its display is aging, the Index remains the gold standard for tracking precision, controller ergonomics, and integrated audio quality.</p>
                        <div class="mt-4 chart-container h-64 sm:h-72"><canvas id="indexRadar"></canvas></div>
                    </div>
                     <button class="ai-button mt-4" onclick="getAiSummary('Valve Index')">‚ú® AI Summary</button>
                </div>
                <div class="stat-card">
                    <div class="flex-grow">
                        <h3 class="text-2xl font-bold brilliant-blues-text-secondary">Pimax Crystal Light</h3>
                        <p class="font-semibold brilliant-blues-text-emphasis">The Visual Fidelity Enthusiast</p>
                        <p class="mt-2 text-sm text-gray-600">For those who demand the absolute best in resolution and clarity, featuring stunning QLED displays and sharp aspheric lenses.</p>
                         <div class="mt-4 chart-container h-64 sm:h-72"><canvas id="pimaxRadar"></canvas></div>
                    </div>
                    <button class="ai-button mt-4" onclick="getAiSummary('Pimax Crystal Light')">‚ú® AI Summary</button>
                </div>
                <div class="stat-card">
                     <div class="flex-grow">
                        <h3 class="text-2xl font-bold brilliant-blues-text-secondary">Bigscreen Beyond 2</h3>
                         <p class="font-semibold brilliant-blues-text-emphasis">The Featherweight Champion</p>
                        <p class="mt-2 text-sm text-gray-600">A revolution in comfort, this ultra-lightweight, custom-fit headset uses Micro-OLED displays for unparalleled long-session immersion.</p>
                         <div class="mt-4 chart-container h-64 sm:h-72"><canvas id="bigscreenRadar"></canvas></div>
                     </div>
                     <button class="ai-button mt-4" onclick="getAiSummary('Bigscreen Beyond 2')">‚ú® AI Summary</button>
                </div>
                <div class="stat-card">
                    <div class="flex-grow">
                        <h3 class="text-2xl font-bold brilliant-blues-text-secondary">Sony PSVR2 (PC)</h3>
                        <p class="font-semibold brilliant-blues-text-emphasis">The OLED Wildcard</p>
                        <p class="mt-2 text-sm text-gray-600">Brings coveted OLED HDR visuals to PCVR, offering vibrant colors and true blacks, though with the caveats of Fresnel lenses and adapter-based setup.</p>
                        <div class="mt-4 chart-container h-64 sm:h-72"><canvas id="psvr2Radar"></canvas></div>
                    </div>
                    <button class="ai-button mt-4" onclick="getAiSummary('Sony PSVR2 (PC)')">‚ú® AI Summary</button>
                </div>
                 <div class="stat-card">
                    <div class="flex-grow">
                        <h3 class="text-2xl font-bold brilliant-blues-text-secondary">HTC Vive Pro 2</h3>
                        <p class="font-semibold brilliant-blues-text-emphasis">The High-Resolution Contender</p>
                        <p class="mt-2 text-sm text-gray-600">A niche option prioritizing raw pixel count. It boasts an incredibly high resolution display paired with proven Lighthouse tracking.</p>
                        <div class="mt-4 chart-container h-64 sm:h-72"><canvas id="vivepro2Radar"></canvas></div>
                    </div>
                    <button class="ai-button mt-4" onclick="getAiSummary('HTC Vive Pro 2')">‚ú® AI Summary</button>
                </div>
            </div>
        </section>

        <section id="analysis" class="mb-16">
            <h2 class="text-3xl font-bold text-center mb-8 brilliant-blues-text-highlight">Visualizing the Trade-Offs</h2>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="stat-card">
                    <h3 class="text-xl font-bold text-center brilliant-blues-text-main mb-4">Price vs. Visual Fidelity</h3>
                    <p class="text-center text-sm text-gray-600 mb-4">This scatter plot reveals the relationship between the total setup cost of a headset and its overall visual quality. Headsets in the top-left quadrant offer higher visual fidelity for a lower price, representing strong value.</p>
                    <div class="chart-container h-80 sm:h-96"><canvas id="priceVsFidelityChart"></canvas></div>
                </div>
                 <div class="stat-card">
                    <h3 class="text-xl font-bold text-center brilliant-blues-text-main mb-4">Market Technology Adoption</h3>
                    <p class="text-center text-sm text-gray-600 mb-4">This chart shows the prevalence of key technologies across the leading headsets. Note the clear market shift towards advanced Pancake and Aspheric lenses over older Fresnel designs.</p>
                     <div class="chart-container h-80 sm:h-96"><canvas id="techAdoptionChart"></canvas></div>
                </div>
            </div>
        </section>

    </main>

    <footer class="text-center py-8 px-4 text-gray-400">
        <p>Data synthesized from the "Top PCVR Headset Analysis" report. All specifications and prices are based on market data as of early 2025 and are subject to change. AI features powered by Google Gemini.</p>
        <p class="text-sm mt-2">Confirmation: No SVG or Mermaid JS used. All charts rendered using Chart.js on Canvas elements.</p>
    </footer>
    
    <div id="aiSummaryModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden opacity-0" onclick="this.classList.add('hidden', 'opacity-0')">
        <div class="stat-card max-w-lg w-full" onclick="event.stopPropagation()">
            <h3 id="aiSummaryModalTitle" class="text-2xl font-bold brilliant-blues-text-secondary mb-4"></h3>
            <div id="aiSummaryModalContent" class="text-gray-700"></div>
            <button class="ai-button mt-6" onclick="document.getElementById('aiSummaryModal').classList.add('hidden', 'opacity-0')">Close</button>
        </div>
    </div>


    <script>
        const brilliantBlues = { main: '#005f73', secondary: '#0a9396', accent: '#94d2bd', highlight: '#e9d8a6', emphasis: '#ee9b00', dark: '#001219', light: '#cae9ff', gridColor: 'rgba(148, 210, 189, 0.2)', fontColor: '#001219' };

        const tooltipTitleCallback = (tooltipItems) => {
            const item = tooltipItems[0];
            let label = item.chart.data.labels[item.dataIndex];
            return Array.isArray(label) ? label.join(' ') : label;
        };

        const radarChartOptions = (displayLegend = false, fontSize = 12) => ({
            responsive: true, maintainAspectRatio: false,
            plugins: { legend: { display: displayLegend, position: 'top', labels: { color: brilliantBlues.fontColor } }, tooltip: { callbacks: { title: tooltipTitleCallback } } },
            scales: { r: { angleLines: { color: brilliantBlues.gridColor }, grid: { color: brilliantBlues.gridColor }, pointLabels: { font: { size: fontSize }, color: brilliantBlues.fontColor }, ticks: { display: false, stepSize: 1 }, min: 0, max: 5 } }
        });
        
        const individualRadarData = {
            labels: ['Clarity', 'Comfort', 'Tracking', 'Value', 'Wireless'],
            datasets: {
                quest3: [{ label: 'Quest 3', data: [4, 3, 4, 5, 5], fill: true, backgroundColor: 'rgba(10, 147, 150, 0.2)', borderColor: brilliantBlues.secondary, pointBackgroundColor: brilliantBlues.secondary }],
                index: [{ label: 'Index', data: [2, 4, 5, 2, 0], fill: true, backgroundColor: 'rgba(0, 95, 115, 0.2)', borderColor: brilliantBlues.main, pointBackgroundColor: brilliantBlues.main }],
                pimax: [{ label: 'Pimax', data: [5, 2, 3, 3, 0], fill: true, backgroundColor: 'rgba(238, 155, 0, 0.2)', borderColor: brilliantBlues.emphasis, pointBackgroundColor: brilliantBlues.emphasis }],
                bigscreen: [{ label: 'Bigscreen', data: [4, 5, 5, 2, 0], fill: true, backgroundColor: 'rgba(148, 210, 189, 0.4)', borderColor: brilliantBlues.accent, pointBackgroundColor: brilliantBlues.accent }],
                psvr2: [{ label: 'PSVR2', data: [3, 4, 4, 4, 0], fill: true, backgroundColor: 'rgba(0, 95, 115, 0.3)', borderColor: brilliantBlues.main, pointBackgroundColor: brilliantBlues.main }],
                vivepro2: [{ label: 'Vive Pro 2', data: [4, 3, 5, 2, 0], fill: true, backgroundColor: 'rgba(233, 216, 166, 0.4)', borderColor: brilliantBlues.highlight, pointBackgroundColor: brilliantBlues.highlight }]
            }
        };

        new Chart(document.getElementById('quest3Radar'), { type: 'radar', data: { labels: individualRadarData.labels, datasets: individualRadarData.datasets.quest3 }, options: radarChartOptions(false, 10) });
        new Chart(document.getElementById('indexRadar'), { type: 'radar', data: { labels: individualRadarData.labels, datasets: individualRadarData.datasets.index }, options: radarChartOptions(false, 10) });
        new Chart(document.getElementById('pimaxRadar'), { type: 'radar', data: { labels: individualRadarData.labels, datasets: individualRadarData.datasets.pimax }, options: radarChartOptions(false, 10) });
        new Chart(document.getElementById('bigscreenRadar'), { type: 'radar', data: { labels: individualRadarData.labels, datasets: individualRadarData.datasets.bigscreen }, options: radarChartOptions(false, 10) });
        new Chart(document.getElementById('psvr2Radar'), { type: 'radar', data: { labels: individualRadarData.labels, datasets: individualRadarData.datasets.psvr2 }, options: radarChartOptions(false, 10) });
        new Chart(document.getElementById('vivepro2Radar'), { type: 'radar', data: { labels: individualRadarData.labels, datasets: individualRadarData.datasets.vivepro2 }, options: radarChartOptions(false, 10) });

        const priceVsFidelityData = {
            datasets: [
                { label: 'Meta Quest 3', data: [{ x: 499, y: 8.5 }], backgroundColor: brilliantBlues.secondary, pointRadius: 10, pointHoverRadius: 15 },
                { label: 'Valve Index', data: [{ x: 999, y: 7.0 }], backgroundColor: brilliantBlues.main, pointRadius: 10, pointHoverRadius: 15 },
                { label: 'Pimax Crystal Light', data: [{ x: 899, y: 9.5 }], backgroundColor: brilliantBlues.emphasis, pointRadius: 10, pointHoverRadius: 15 },
                { label: 'Bigscreen Beyond 2', data: [{ x: 1369, y: 9.2 }], backgroundColor: brilliantBlues.accent, pointRadius: 10, pointHoverRadius: 15 },
                { label: 'Sony PSVR2 (PC)', data: [{ x: 610, y: 7.5 }], backgroundColor: brilliantBlues.main, pointRadius: 10, pointHoverRadius: 15, pointStyle: 'triangle' },
                { label: 'HTC Vive Pro 2', data: [{ x: 1300, y: 8.0 }], backgroundColor: brilliantBlues.highlight, pointRadius: 10, pointHoverRadius: 15 }
            ]
        };
        new Chart(document.getElementById('priceVsFidelityChart'), {
            type: 'scatter', data: priceVsFidelityData,
            options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false }, tooltip: { callbacks: { label: (c) => `${c.dataset.label}: ($${c.parsed.x}, ${c.parsed.y} Score)`, title: () => '' } } }, scales: { x: { title: { display: true, text: 'Total Setup Cost (USD - Approx.)', color: brilliantBlues.fontColor }, ticks: { color: brilliantBlues.fontColor }, grid: { color: brilliantBlues.gridColor } }, y: { title: { display: true, text: 'Visual Fidelity Score (Composite)', color: brilliantBlues.fontColor }, ticks: { color: brilliantBlues.fontColor }, grid: { color: brilliantBlues.gridColor }, min: 6, max: 10 } } }
        });

        const techAdoptionData = {
            labels: ['Lens Technology', 'Display Technology', 'Tracking Technology'],
            datasets: [
                { label: 'Pancake / Aspheric', data: [4, 0, 0], backgroundColor: brilliantBlues.secondary },
                { label: 'Fresnel', data: [2, 0, 0], backgroundColor: brilliantBlues.highlight },
                { label: 'LCD / QLED', data: [0, 4, 0], backgroundColor: brilliantBlues.secondary },
                { label: 'OLED / Micro-OLED', data: [0, 2, 0], backgroundColor: brilliantBlues.main },
                { label: 'Inside-Out', data: [0, 0, 3], backgroundColor: brilliantBlues.secondary },
                { label: 'Lighthouse', data: [0, 0, 3], backgroundColor: brilliantBlues.accent }
            ]
        };
        new Chart(document.getElementById('techAdoptionChart'), {
            type: 'bar', data: techAdoptionData,
            options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'top', labels: { color: brilliantBlues.fontColor } }, tooltip: { callbacks: { title: tooltipTitleCallback } } }, scales: { x: { ticks: { color: brilliantBlues.fontColor }, grid: { display: false } }, y: { ticks: { color: brilliantBlues.fontColor, stepSize: 1 }, grid: { color: brilliantBlues.gridColor }, stacked: true } } }
        });

        const recommendationBtn = document.getElementById('get-recommendation-btn');
        const recommendationResultDiv = document.getElementById('ai-recommendation-result');
        const userPromptTextarea = document.getElementById('user-prompt');
        
        const summaryModal = document.getElementById('aiSummaryModal');
        const summaryModalTitle = document.getElementById('aiSummaryModalTitle');
        const summaryModalContent = document.getElementById('aiSummaryModalContent');

        const headsetData = `
            - Meta Quest 3: The versatile all-rounder. Great value ($499), excellent wireless PCVR, clear pancake lenses. Best for a broad audience, mixed usage, and ease of use.
            - Valve Index: The tracking & audio champion. Gold standard for tracking precision and controller ergonomics ($999 kit), but display is aging. Best for hardcore enthusiasts who demand perfect tracking.
            - Pimax Crystal Light: The visual fidelity enthusiast. Top-tier resolution and clarity with QLED displays ($899 headset only). For users who want the absolute best visuals, especially for simulators.
            - Bigscreen Beyond 2: The featherweight champion. Ultra-lightweight and custom-fit for maximum comfort ($1369 with trackers/base stations). Best for long social VR sessions.
            - Sony PSVR2 (PC): The OLED wildcard. Brings OLED HDR visuals to PC ($610 with adapter), but has Fresnel lenses. A good choice for those who prioritize vibrant colors and deep blacks.
            - HTC Vive Pro 2: The high-resolution contender. Prioritizes raw pixel count with Lighthouse tracking ($1300+ kit). A niche choice for professionals or users with specific high-res needs.
        `;

        async function getAiSummary(headsetName) {
            summaryModalTitle.textContent = `‚ú® AI Summary: ${headsetName}`;
            summaryModalContent.innerHTML = `<div class="loader mx-auto"></div>`;
            summaryModal.classList.remove('hidden');
            setTimeout(()=>summaryModal.classList.remove('opacity-0'), 10);
            
            const prompt = `You are a helpful assistant. In two concise sentences, summarize the key strengths and ideal user for the ${headsetName} PCVR headset.`;
            
            try {
                const text = await callGemini(prompt);
                summaryModalContent.innerHTML = `<p>${text}</p>`;
            } catch (error) {
                console.error('Error fetching AI summary:', error);
                summaryModalContent.innerHTML = `<p class="text-red-500">Sorry, I couldn't generate a summary at this time. Please try again later.</p>`;
            }
        }
        
        recommendationBtn.addEventListener('click', async () => {
            const userPrompt = userPromptTextarea.value;
            if (!userPrompt.trim()) {
                recommendationResultDiv.innerHTML = '<p class="text-red-500">Please describe what you are looking for first.</p>';
                return;
            }

            recommendationResultDiv.innerHTML = '<div class="loader mx-auto"></div><p class="text-center mt-2">Generating your personalized recommendation...</p>';
            recommendationBtn.disabled = true;

            const fullPrompt = `You are an expert in PCVR technology. Your task is to provide a personalized PCVR headset recommendation based on the user's needs.

            Here is the summary of the top PCVR headsets in 2025:
            ${headsetData}

            A user has the following requirements: "${userPrompt}".

            Based on this, which headset (or headsets) would you recommend and why? Explain your reasoning clearly, referencing the user's specific needs and the strengths/weaknesses of the recommended headset(s). Format your response as simple HTML paragraphs. Start with a bolded h3 tag with your top recommendation.`;

            try {
                const text = await callGemini(fullPrompt);
                recommendationResultDiv.innerHTML = text;
            } catch (error) {
                console.error('Error fetching AI recommendation:', error);
                recommendationResultDiv.innerHTML = '<p class="text-red-500">Sorry, an error occurred while generating your recommendation. Please check the console for details and try again.</p>';
            } finally {
                recommendationBtn.disabled = false;
            }
        });
        
        async function callGemini(prompt) {
             const apiKey = ""; 
             const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
             
             const payload = {
                 contents: [{ role: "user", parts: [{ text: prompt }] }],
                 generationConfig: {
                    temperature: 0.7,
                    topK: 1,
                    topP: 1,
                    maxOutputTokens: 8192,
                 }
             };
             
             const response = await fetch(apiUrl, {
                 method: 'POST',
                 headers: { 'Content-Type': 'application/json' },
                 body: JSON.stringify(payload)
             });
             
             if (!response.ok) {
                throw new Error(`API call failed with status: ${response.status}`);
             }

             const result = await response.json();
             
             if (result.candidates && result.candidates.length > 0 && result.candidates[0].content && result.candidates[0].content.parts && result.candidates[0].content.parts.length > 0) {
                 return result.candidates[0].content.parts[0].text.replace(/\n/g, '<br>');
             } else {
                 console.log("Unexpected Gemini API response structure: ", result);
                 throw new Error("Could not extract text from Gemini API response.");
             }
        }
        
        // Expose the summary function to global scope so inline onclick can find it
        window.getAiSummary = getAiSummary;

    </script>

</body>
</html>
